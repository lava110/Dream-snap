<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DreamSnap - AI æ¢ç´¢å®éªŒå®¤</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        /* æŠŠæˆªå›¾é‡Œçš„æ ·å¼éƒ½æ•´åˆåœ¨è¿™é‡Œäº† */
        :root { --primary-color: #FF6B6B; --secondary-color: #4ECDC4; --bg-color: #F7F9FC; --card-bg: #FFFFFF; --text-color: #2D3436; }
        body { font-family: 'Segoe UI', sans-serif; background-color: var(--bg-color); color: var(--text-color); display: flex; justify-content: center; padding: 20px; margin: 0; }
        .container { max-width: 1100px; width: 100%; background: var(--card-bg); border-radius: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); padding: 30px; text-align: center; }
        .workspace { display: flex; gap: 40px; align-items: flex-start; text-align: left; margin-top: 30px; }
        .panel-left { flex: 1; min-width: 300px; }
        .panel-right { flex: 1.3; position: sticky; top: 20px; background: var(--card-bg); z-index: 10; }
        @media (max-width: 768px) { .workspace { flex-direction: column; } .panel-right { position: static; width: 100%; } }
        h1 { font-size: 2.5rem; color: var(--primary-color); margin: 0 0 5px 0; }
        .tabs { display: flex; justify-content: center; background: #EEE; border-radius: 50px; padding: 5px; }
        .tab-btn { flex: 1; padding: 12px; border: none; background: transparent; border-radius: 40px; font-weight: bold; cursor: pointer; color: #666; }
        .tab-btn.active { background: var(--primary-color); color: white; }
        .mode-content { display: none; animation: fadeIn 0.5s; }
        .mode-content.active { display: block; }
        .control-group { background: #FAFAFA; border-radius: 15px; padding: 15px; margin-bottom: 15px; border: 1px solid #EEE; }
        .control-label { font-weight: bold; margin-bottom: 8px; display: block; }
        select, input { width: 100%; padding: 10px; border-radius: 10px; border: 1px solid #DDD; box-sizing: border-box; }
        .magic-btn { width: 100%; border-radius: 15px; border: none; background: linear-gradient(145deg, #FF6B6B, #FF8E8E); color: white; font-size: 1.2rem; font-weight: bold; cursor: pointer; padding: 15px; margin-top: 20px; }
        .viewfinder { width: 100%; aspect-ratio: 3/2; background: #000; border-radius: 20px; overflow: hidden; position: relative; border: 5px solid #FFF; box-shadow: 0 10px 20px rgba(0,0,0,0.15); margin-bottom: 15px; }
        .viewfinder img { width: 100%; height: 100%; object-fit: cover; transition: opacity 0.5s; }
        .spinner { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white; background: rgba(0,0,0,0.7); padding: 10px 20px; border-radius: 20px; display: none; }
        .output-box { background: #2D3436; color: #dfe6e9; padding: 20px; border-radius: 15px; font-family: monospace; min-height: 80px; line-height: 1.6; word-break: break-word; }
        .token-style { color: #FF7675; } .token-subject { color: #74B9FF; } .token-emotion { color: #A29BFE; } .token-env { color: #FD79A8; } .token-zoom { color: #55EFC4; }
        .gallery-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 15px; margin-top: 20px; }
        .gallery-card { height: 140px; perspective: 1000px; cursor: pointer; }
        .card-inner { position: relative; width: 100%; height: 100%; transition: transform 0.6s; transform-style: preserve-3d; border-radius: 15px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .gallery-card:hover .card-inner, .gallery-card.flipped .card-inner { transform: rotateY(180deg); }
        .card-front, .card-back { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 15px; overflow: hidden; }
        .card-front img { width: 100%; height: 100%; object-fit: cover; }
        .card-back { background: #2D3436; color: #81ECEC; transform: rotateY(180deg); display: flex; align-items: center; justify-content: center; padding: 10px; font-size: 0.6rem; overflow: auto; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .action-btn { flex: 1; border: none; padding: 10px; border-radius: 10px; cursor: pointer; font-weight: bold; color: white; margin-right:5px;}
        .copy-btn { background: #74B9FF; } .download-btn { background: #4ECDC4; }
        .optimize-btn, .save-btn { width: 100%; margin-top: 10px; padding: 12px; border-radius: 15px; color: white; border: none; font-weight: bold; cursor: pointer; }
        .optimize-btn { background: #A29BFE; } .save-btn { background: #FF7675; }
    </style>
</head>
<body>
<div class="container">
    <h1>âœ¨ DreamSnap</h1>
    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('auto')">ğŸ² è‡ªåŠ¨é€ æ¢¦</button>
        <button class="tab-btn" onclick="switchTab('manual')">ğŸ› ï¸ äººå·¥å®éªŒå®¤</button>
        <button class="tab-btn" onclick="switchTab('challenge')">ğŸ† æŒ‘æˆ˜ä»»åŠ¡</button>
    </div>
    <div class="workspace">
        <div class="panel-left">
            <div id="auto-mode" class="mode-content active">
                <div class="control-group" style="text-align:center; border:none; background:transparent; padding-top:40px;">
                    <button class="magic-btn" onclick="generateAutoPrompt()">âœ¨ ç«‹å³é€ æ¢¦</button>
                </div>
            </div>
            <div id="manual-mode" class="mode-content">
                <div id="mission-board" style="display:none; background:#FFF3CD; border:2px solid #FFC107; border-radius:15px; padding:15px; margin-bottom:20px;">
                    <h3 style="margin:0; color:#856404;">ğŸš© <span id="level-title">Level 1</span></h3>
                    <p id="mission-desc" style="color:#856404; font-size:0.9rem;">åŠ è½½ä¸­...</p>
                    <ul id="mission-checklist" style="padding-left:20px; font-size:0.9rem;"></ul>
                    <button id="next-level-btn" onclick="nextLevel()" style="display:none; width:100%; background:#2ecc71; color:white; border:none; padding:10px; border-radius:20px; margin-top:10px; cursor:pointer;">ğŸ‰ ä¸‹ä¸€å…³</button>
                </div>
                <div class="control-group"><label class="control-label">ğŸ‘¤ ä¸»è§’</label><select id="subject-select" onchange="handleUpdate()"><option value="girl">èµ›åšå°‘å¥³</option><option value="cat">å®‡èˆªå‘˜çŒ«å’ª</option><option value="robot">å¤å¤æœºå™¨äºº</option><option value="wizard">é­”æ³•å¸ˆ</option><option value="house">éœæ¯”ç‰¹å°å±‹</option></select></div>
                <div class="control-group"><label class="control-label">ğŸ˜Š æƒ…ç»ª</label><input type="range" id="emotion-slider" min="0" max="4" step="1" value="1" oninput="handleUpdate()"></div>
                <div class="control-group"><label class="control-label">ğŸ¨ é£æ ¼</label><select id="style-select" onchange="handleUpdate()"><option value="real">æ‰‹æœºæŠ“æ‹</option><option value="cinema">ç”µå½±å¤§ç‰‡</option><option value="3d">3Dæ¸²æŸ“</option><option value="pixel">åƒç´ è‰ºæœ¯</option></select></div>
                <div class="control-group"><label class="control-label">ğŸ’¡ å…‰ç…§</label><select id="light-select" onchange="handleUpdate()"><option value="natural">è‡ªç„¶å…‰</option><option value="neon">èµ›åšéœ“è™¹</option></select></div>
                <div class="control-group"><label class="control-label">ğŸŒ¦ï¸ å¤©æ°”</label><select id="weather-select" onchange="handleUpdate()"><option value="clear">æ™´æœ—</option><option value="rain">ä¸‹é›¨</option></select></div>
                <div class="control-group"><label class="control-label">ğŸ“· è¿é•œ</label><input type="range" id="zoom-slider" min="0" max="4" step="1" value="1" oninput="handleUpdate()"></div>
                <div style="background:#e8f0fe; padding:10px; border-radius:10px; display:flex; justify-content:space-between;"><span>ğŸ§ª å®éªŒæ¨¡å¼ (Seed Lock)</span><input type="checkbox" id="seed-lock" onchange="toggleSeedLock()"></div>
                <button class="magic-btn" onclick="manualSnap()">ğŸ“¸ ç‚¹å‡»æ˜¾å½±</button>
            </div>
        </div>
        <div class="panel-right">
            <div class="viewfinder">
                <div id="loading-spinner" class="spinner">ğŸ”® æ­£åœ¨æ˜¾å½±...</div>
                <img id="preview-img" src="https://placehold.co/600x400/2D3436/FFF?text=Ready+to+Dream" alt="Preview">
            </div>
            <div class="output-box" id="prompt-result" data-raw="">ç­‰å¾…æŒ‡ä»¤ä¸­... ğŸ¤–</div>
            <div style="display:flex; gap:10px; margin-top:10px;">
                <button class="action-btn copy-btn" onclick="copyToClipboard()">ğŸ“‹ å¤åˆ¶</button>
                <button class="action-btn download-btn" onclick="downloadImage()">â¬‡ï¸ ä¸‹è½½</button>
            </div>
            <button class="optimize-btn" onclick="optimizePrompt()">âœ¨ é­”æ³•ä¼˜åŒ–</button>
            <button class="save-btn" onclick="saveToGallery()">â¤ï¸ æ”¶è—è¿›ç”»å»Š</button>
        </div>
    </div>
    <div class="gallery-section"><h2>ğŸ–¼ï¸ æ¢¦å¢ƒç”»å»Š</h2><div id="gallery-grid" class="gallery-grid"></div><button onclick="clearGallery()" style="background:none; border:none; color:#999; margin-top:20px; cursor:pointer;">ğŸ—‘ï¸ æ¸…ç©ºç”»å»Š</button></div>
</div>

<script>
    // --- è¿™é‡Œå°±æ˜¯æŠŠä½ æˆªå›¾é‡Œæ‰€æœ‰tsxæ–‡ä»¶åˆå¹¶åçš„é€»è¾‘ ---
    const manualData = {
        subjects: { "girl": "cyberpunk girl, neon hair", "cat": "cute tabby cat astronaut", "robot": "vintage tin robot", "wizard": "gandalf wizard", "house": "hobbit house" },
        emotions: ["crying", "neutral", "laughing", "angry", "surprised"],
        zooms: ["extreme close-up", "portrait", "medium shot", "full body", "drone view"],
        styles: { "real": "hyper-realistic, 8k", "cinema": "cinematic movie scene", "3d": "3D render", "pixel": "pixel art" },
        lightings: { "natural": "soft sunlight", "neon": "neon lights" },
        weathers: { "clear": "clear sky", "rain": "heavy rain" }
    };
    const missions = [
        { id: 1, title: "æ‚²ä¼¤çš„é›¨å¤œ", desc: "ç”Ÿæˆ: **é›¨ä¸­** çš„ **æ‚²ä¼¤** **èµ›åšå°‘å¥³**", requirements: { "subject-select": "girl", "weather-select": "rain", "emotion-slider": "0" } }
    ];
    let currentLockedSeed = null; let isChallengeActive = false; let currentLevel = 0;

    function handleUpdate() { updateManualPrompt(); if(isChallengeActive) checkMissionProgress(); }
    function updateManualPrompt() {
        const s = document.getElementById('subject-select').value, e = document.getElementById('emotion-slider').value, z = document.getElementById('zoom-slider').value, st = document.getElementById('style-select').value, l = document.getElementById('light-select').value, w = document.getElementById('weather-select').value;
        const raw = `${manualData.styles[st]||st}, ${manualData.subjects[s]||s}, ${manualData.emotions[e]||e}, ${manualData.lightings[l]||l}, ${manualData.weathers[w]||w}, ${manualData.zooms[z]||z}, best quality.`;
        document.getElementById('prompt-result').setAttribute('data-raw', raw);
        document.getElementById('prompt-result').innerHTML = `<span class="token-style">[é£æ ¼] ${st}</span> <span class="token-subject">[ä¸»ä½“] ${s}</span> ...`;
    }
    function generateAutoPrompt() { 
        const raw = "A mystical forest spirit, glowing lights, masterpiece, 8k.";
        document.getElementById('prompt-result').setAttribute('data-raw', raw); document.getElementById('prompt-result').innerText = raw; runNanoBanana(raw); 
    }
    function manualSnap() { runNanoBanana(document.getElementById('prompt-result').getAttribute('data-raw')); }
    function runNanoBanana(prompt) {
        const img = document.getElementById('preview-img'); const spin = document.getElementById('loading-spinner');
        spin.style.display='block'; img.style.opacity='0.5';
        let seed = currentLockedSeed !== null ? currentLockedSeed : Math.floor(Math.random()*9999);
        img.src = `https://image.pollinations.ai/prompt/${encodeURIComponent(prompt)}?width=600&height=400&seed=${seed}&nologo=true`;
        img.onload = () => { spin.style.display='none'; img.style.opacity='1'; };
    }
    function switchTab(mode) {
        document.querySelectorAll('.mode-content').forEach(d=>d.classList.remove('active')); document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
        document.getElementById('mission-board').style.display='none'; isChallengeActive=false;
        if(mode==='auto'){document.getElementById('auto-mode').classList.add('active');document.querySelectorAll('.tab-btn')[0].classList.add('active');}
        else{document.getElementById('manual-mode').classList.add('active'); if(mode==='challenge'){document.getElementById('mission-board').style.display='block';isChallengeActive=true;loadMission(0);}else{document.querySelectorAll('.tab-btn')[1].classList.add('active');}}
    }
    function loadMission(idx){ 
        if(idx>=missions.length){alert("é€šå…³!");return;}
        const m=missions[idx]; document.getElementById('level-title').innerText=`Level ${m.id}`; document.getElementById('mission-desc').innerHTML=m.desc;
    }
    function checkMissionProgress(){ 
        const m=missions[0]; 
        const list=document.getElementById('mission-checklist'); list.innerHTML="";
        let all=true; 
        for(const [k,v] of Object.entries(m.requirements)){
            const match = document.getElementById(k).value === v; if(!match) all=false;
            list.innerHTML += `<li>${match?'âœ…':'âŒ'} ${k}</li>`;
        }
        if(all) document.getElementById('next-level-btn').style.display='block';
    }
    function toggleSeedLock(){ const l=document.getElementById('seed-lock').checked; if(l&&!currentLockedSeed)currentLockedSeed=Math.floor(Math.random()*9999); if(!l)currentLockedSeed=null; }
    function optimizePrompt(){ manualSnap(); } 
    function copyToClipboard(){ navigator.clipboard.writeText(document.getElementById('prompt-result').getAttribute('data-raw')); }
    function downloadImage(){ const a=document.createElement('a'); a.href=document.getElementById('preview-img').src; a.download='dream.webp'; a.click(); }
    function saveToGallery(){ const u=document.getElementById('preview-img').src; const g=document.getElementById('gallery-grid'); g.innerHTML+=`<div class="gallery-card"><img src="${u}" style="width:100%;height:100%;object-fit:cover;border-radius:10px;"></div>`; }
    function clearGallery(){ document.getElementById('gallery-grid').innerHTML=""; }
</script>
</body>
</html>
